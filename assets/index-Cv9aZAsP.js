import{U as et,V as X,S as Z,a0 as nt,a1 as q,s,c3 as V,f as at,v as ot,K as rt,al as lt,c4 as st,c as it,o as ct,r as ut,a6 as ft,az as dt,aP as vt}from"./index-CkTquMHh.js";const gt=et({zIndex:{type:Number,default:9},rotate:{type:Number,default:-22},width:Number,height:Number,image:String,content:{type:X([String,Array]),default:"Element Plus"},font:{type:X(Object)},gap:{type:X(Array),default:()=>[100,100]},offset:{type:X(Array)}});function pt(o){return o.replace(/([A-Z])/g,"-$1").toLowerCase()}function ht(o){return Object.keys(o).map(n=>`${pt(n)}: ${o[n]};`).join(" ")}function mt(){return window.devicePixelRatio||1}const xt=(o,n)=>{let u=!1;return o.removedNodes.length&&n&&(u=Array.from(o.removedNodes).includes(n)),o.type==="attributes"&&o.target===n&&(u=!0),u},J=3;function G(o,n,u=1){const r=document.createElement("canvas"),x=r.getContext("2d"),b=o*u,B=n*u;return r.setAttribute("width",`${b}px`),r.setAttribute("height",`${B}px`),x.save(),[x,r,b,B]}function bt(){function o(n,u,r,x,b,B,H,Y){const[y,T,_,W]=G(x,b,r);if(n instanceof HTMLImageElement)y.drawImage(n,0,0,_,W);else{const{color:i,fontSize:d,fontStyle:k,fontWeight:m,fontFamily:F,textAlign:j,textBaseline:D}=B,O=Number(d)*r;y.font=`${k} normal ${m} ${O}px/${b}px ${F}`,y.fillStyle=i,y.textAlign=j,y.textBaseline=D;const R=Z(n)?n:[n];R==null||R.forEach((K,tt)=>{y.fillText(K??"",_/2,tt*(O+J*r))})}const M=Math.PI/180*Number(u),L=Math.max(x,b),[P,U,v]=G(L,L,r);P.translate(v/2,v/2),P.rotate(M),_>0&&W>0&&P.drawImage(T,-_/2,-W/2);function c(i,d){const k=i*Math.cos(M)-d*Math.sin(M),m=i*Math.sin(M)+d*Math.cos(M);return[k,m]}let S=0,C=0,z=0,N=0;const I=_/2,$=W/2;[[0-I,0-$],[0+I,0-$],[0+I,0+$],[0-I,0+$]].forEach(([i,d])=>{const[k,m]=c(i,d);S=Math.min(S,k),C=Math.max(C,k),z=Math.min(z,m),N=Math.max(N,m)});const t=S+v/2,e=z+v/2,a=C-S,f=N-z,g=H*r,w=Y*r,A=(a+g)*2,E=f+w,[p,l]=G(A,E);function h(i=0,d=0){p.drawImage(U,t,e,a,f,i,d,a,f)}return h(),h(a+g,-f/2-w/2),h(a+g,+f/2+w/2),[l.toDataURL(),A/r,E/r]}return o}const yt=q({name:"ElWatermark"}),_t=q({...yt,props:gt,setup(o){const n=o,u={position:"relative"},r=s(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.color)!=null?e:"rgba(0,0,0,.15)"}),x=s(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.fontSize)!=null?e:16}),b=s(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.fontWeight)!=null?e:"normal"}),B=s(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.fontStyle)!=null?e:"normal"}),H=s(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.fontFamily)!=null?e:"sans-serif"}),Y=s(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.textAlign)!=null?e:"center"}),y=s(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.textBaseline)!=null?e:"hanging"}),T=s(()=>n.gap[0]),_=s(()=>n.gap[1]),W=s(()=>T.value/2),M=s(()=>_.value/2),L=s(()=>{var t,e;return(e=(t=n.offset)==null?void 0:t[0])!=null?e:W.value}),P=s(()=>{var t,e;return(e=(t=n.offset)==null?void 0:t[1])!=null?e:M.value}),U=()=>{const t={zIndex:n.zIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let e=L.value-W.value,a=P.value-M.value;return e>0&&(t.left=`${e}px`,t.width=`calc(100% - ${e}px)`,e=0),a>0&&(t.top=`${a}px`,t.height=`calc(100% - ${a}px)`,a=0),t.backgroundPosition=`${e}px ${a}px`,t},v=V(null),c=V(),S=at(!1),C=()=>{c.value&&(c.value.remove(),c.value=void 0)},z=(t,e)=>{var a;v.value&&c.value&&(S.value=!0,c.value.setAttribute("style",ht({...U(),backgroundImage:`url('${t}')`,backgroundSize:`${Math.floor(e)}px`})),(a=v.value)==null||a.append(c.value),setTimeout(()=>{S.value=!1}))},N=t=>{let e=120,a=64;const{image:f,content:g,width:w,height:A,rotate:E}=n;if(!f&&t.measureText){t.font=`${Number(x.value)}px ${H.value}`;const p=Z(g)?g:[g];let l=0,h=0;p.forEach(k=>{const{width:m,fontBoundingBoxAscent:F,fontBoundingBoxDescent:j,actualBoundingBoxAscent:D,actualBoundingBoxDescent:O}=t.measureText(k),R=dt(F)?D+O:F+j;m>l&&(l=Math.ceil(m)),R>h&&(h=Math.ceil(R))}),e=l,a=h*p.length+(p.length-1)*J;const i=Math.PI/180*Number(E),d=Math.ceil(Math.abs(Math.sin(i)*a)/2);e+=d}return[w??e,A??a]},I=bt(),$=()=>{const e=document.createElement("canvas").getContext("2d"),a=n.image,f=n.content,g=n.rotate;if(e){c.value||(c.value=document.createElement("div"));const w=mt(),[A,E]=N(e),p=l=>{const[h,i]=I(l||"",g,w,A,E,{color:r.value,fontSize:x.value,fontStyle:B.value,fontWeight:b.value,fontFamily:H.value,textAlign:Y.value,textBaseline:y.value},T.value,_.value);z(h,i)};if(a){const l=new Image;l.onload=()=>{p(l)},l.onerror=()=>{p(f)},l.crossOrigin="anonymous",l.referrerPolicy="no-referrer",l.src=a}else p(f)}};return ot(()=>{$()}),rt(()=>n,()=>{$()},{deep:!0,flush:"post"}),lt(()=>{C()}),st(v,t=>{S.value||t.forEach(e=>{xt(e,c.value)&&(C(),$())})},{attributes:!0,subtree:!0,childList:!0}),(t,e)=>(ct(),it("div",{ref_key:"containerRef",ref:v,style:ft([u])},[ut(t.$slots,"default")],4))}});var Mt=nt(_t,[["__file","watermark.vue"]]);const $t=vt(Mt);export{$t as E};
